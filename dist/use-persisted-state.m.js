import{useRef as r,useState as e,useEffect as n,useCallback as t}from"react";import o from"@use-it/event-listener";var a={},l=function(r,e,n){return a[r]||(a[r]={callbacks:[],value:n}),a[r].callbacks.push(e),{deregister:function(){var n=a[r].callbacks,t=n.indexOf(e);t>-1&&n.splice(t,1)},emit:function(n){a[r].value!==n&&(a[r].value=n,a[r].callbacks.forEach(function(r){e!==r&&r(n)}))}}};export default function(a,c){if(void 0===c&&(c="undefined"!=typeof global&&global.localStorage?global.localStorage:"undefined"!=typeof globalThis&&globalThis.localStorage?globalThis.localStorage:"undefined"!=typeof window&&window.localStorage?window.localStorage:"undefined"!=typeof localStorage?localStorage:null),c){var i=function(r){return{get:function(e,n){var t=r.getItem(e);if(null==t)return"function"==typeof n?n():n;try{return JSON.parse(t)}catch(r){return console.error('Error parsing JSON for key "'+e+'":',r),"function"==typeof n?n():n}},set:function(e,n){r.setItem(e,JSON.stringify(n))}}}(c);return function(c){return function(a,c,i){var u=i.get,f=i.set,s=r(null),g=e(function(){return u(c,a)}),d=g[0],p=g[1];o("storage",function(r){var e=r.newValue;if(r.key===c)try{var n=JSON.parse(e);d!==n&&p(n)}catch(r){console.error('Error parsing JSON for key "'+c+'":',r),d!==e&&p(e)}}),n(function(){return s.current=l(c,p,a),function(){s.current.deregister()}},[a,c]);var v=t(function(r){var e="function"==typeof r?r(d):r;f(c,e),p(e),s.current.emit(r)},[d,f,c]);return[d,v]}(c,a,i)}}return e}
